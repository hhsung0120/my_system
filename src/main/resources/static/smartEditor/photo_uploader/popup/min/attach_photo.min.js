function checkDragAndDropAPI(){bSupportDragAndDropAPI=!1}function goStartMode(){var e=welBtnConfirm.attr("src")||"";e.indexOf("btn_confirm2.png")<0&&(welBtnConfirm.attr("src","../../img/photoQuickPopup/btn_confirm2.png"),fnUploadImage.attach(welBtnConfirm.$value(),"click"))}function goReadyMode(){var e=welBtnConfirm.attr("src")||"";e.indexOf("btn_confirm2.png")>=0&&(fnUploadImage.detach(welBtnConfirm.$value(),"click"),welBtnConfirm.attr("src","../../img/photoQuickPopup/btn_confirm.png"))}function generalUpload(){oFileUploader.upload()}function readyModeBG(){var e=welTextGuide.className();e.indexOf("nobg")>=0&&(welTextGuide.removeClass("nobg"),welTextGuide.className("bg"))}function startModeBG(){var e=welTextGuide.className();e.indexOf("nobg")<0&&(welTextGuide.removeClass("bg"),welTextGuide.className("nobg"))}function updateViewCount(e,t){var n=e+t;return elCountTxtTxt.innerHTML=n+"장",nImageFileCount=n,n}function updateViewTotalSize(){var e=Number(parseInt(nTotalSize||0,10)/1048576);elTotalSizeTxt.innerHTML=e.toFixed(2)+"MB"}function refreshTotalImageSize(e){var t=htImageInfo[e].size;nTotalSize-t>-1&&(nTotalSize-=t)}function removeImageInfo(e){htImageInfo[e]=null}function setUnitString(e){var t,n;return 0>e&&(e=0),1024>e?(t=Number(e),n="B",t+n):e>1048576?(t=Number(parseInt(e||0,10)/1048576),n="MB",t.toFixed(2)+n):(t=Number(parseInt(e||0,10)/1024),n="KB",t.toFixed(0)+n)}function cuttingNameByLength(e,t){var n,o;return e.length>t?(o=e.indexOf("."),n=e.substring(0,t)+"..."+e.substring(o,e.length)):n=e,n}function checkTotalImageSize(e){return nMaxTotalImageSize>nTotalSize+e?(nTotalSize+=e,!1):!0}function dragEnter(e){e.stopPropagation(),e.preventDefault()}function dragExit(e){e.stopPropagation(),e.preventDefault()}function dragOver(e){e.stopPropagation(),e.preventDefault()}function drop(e){if(e.stopPropagation(),e.preventDefault(),nImageFileCount>=10)return alert("최대 10장까지만 등록할 수 있습니다."),void 0;if("undefined"==typeof e.dataTransfer.files)alert("HTML5를 지원하지 않는 브라우저입니다.");else{var t,n,o="";if(t=e.dataTransfer.files,n=t.length,t&&0===n)return alert("정상적인 첨부방식이 아닙니다."),void 0;for(var a=0,r=nImageFileCount;n>a;a++)if(rFilter.test(t[a].type))if(t[a].size>nMaxImageSize)alert("이미지 용량이 10MB를 초과하여 등록할 수 없습니다.");else{if(!(nMaxImageCount>r)){alert("최대 10장까지만 등록할 수 있습니다.");break}o+=addImage(t[a]),r+=1,nImageInfoCnt+=1}else alert("이미지파일 (jpg,gif,png,bmp)만 업로드 가능합니다.");r>0?(startModeBG(),o.length>1&&welDropAreaUL.prependHTML(o),updateViewTotalSize(),nImageFileCount=r,updateViewCount(nImageFileCount,0),goStartMode()):readyModeBG()}}function addImage(e){var e=e,t=0,n="",o="",a=!1,r=[];return t=setUnitString(e.size),n=cuttingNameByLength(e.name,15),a=checkTotalImageSize(e.size),a?alert("전체 이미지 용량이 50MB를 초과하여 등록할 수 없습니다. \n\n (파일명 : "+n+", 사이즈 : "+t+")"):(htImageInfo["img"+nImageInfoCnt]=e,r.push('	<li id="img'+nImageInfoCnt+'" class="imgLi"><span>'+n+"</span>"),r.push("	<em>"+t+"</em>"),r.push("	<a onclick=\"delImage('img"+nImageInfoCnt+'\')"><img class="del_button" src="../../img/photoQuickPopup/btn_del.png"  width="14" height="13" alt="첨부 사진 삭제"></a>'),r.push("	</li> "),o=r.join(" "),r=[]),o}function html5Upload(){var e,t;t="/upload/SmartEditorHtml5Upload";for(var n=0,o=0;nImageInfoCnt>n;n++){e=htImageInfo["img"+n];try{e&&(callAjaxForHTML5(e,t),o+=1)}catch(a){}e=null}}function callAjaxForHTML5(e,t){var n=jindo.$Ajax(t,{type:"xhr",method:"post",onload:function(e){var t=e._response.responseText;if(4==e.readyState())if(t.indexOf("NOTALLOW_")>-1){var n=t.replace("NOTALLOW_","");alert("이미지 파일(jpg,gif,png,bmp)만 업로드 하실 수 있습니다. ("+n+")")}else makeArrayFromString(e._response.responseText)},timeout:3,onerror:jindo.$Fn(onAjaxError,this).bind()});n.header("contentType","multipart/form-data"),n.header("file-name",encodeURIComponent(e.name)),n.header("file-size",e.size),n.header("file-Type",e.type),n.request(e)}function makeArrayFromString(e){var t=[],n=[],o={};aResultleng=0;try{if(!e||e.indexOf("sFileURL")<0)return;t=e.split("&");for(var a=0;a<t.length;a++)t[a]&&""!=t[a]&&t[a].indexOf("=")>0&&(n=t[a].split("="),o[n[0]]=n[1])}catch(r){}aResultleng=aResult.length,aResult[aResultleng]=o,aResult.length==nImageFileCount&&(setPhotoToEditor(aResult),aResult=null,window.close())}function delImage(e){var t=jindo.$$.getSingle("#"+e);refreshTotalImageSize(e),updateViewTotalSize(),updateViewCount(nImageFileCount,-1),removeImageInfo(e),$Element(t).leave(),0===nImageFileCount&&(readyModeBG(),goReadyMode()),bAttachEvent||addEvent()}function addEvent(){bAttachEvent=!0,elDropArea.addEventListener("dragenter",dragEnter,!1),elDropArea.addEventListener("dragexit",dragExit,!1),elDropArea.addEventListener("dragover",dragOver,!1),elDropArea.addEventListener("drop",drop,!1)}function removeEvent(){bAttachEvent=!1,elDropArea.removeEventListener("dragenter",dragEnter,!1),elDropArea.removeEventListener("dragexit",dragExit,!1),elDropArea.removeEventListener("dragover",dragOver,!1),elDropArea.removeEventListener("drop",drop,!1)}function onAjaxError(){alert("[가이드]사진 업로더할 서버URL셋팅이 필요합니다.-onAjaxError")}function uploadImage(){bSupportDragAndDropAPI?html5Upload():generalUpload()}function callFileUploader(){oFileUploader=new jindo.FileUploader(jindo.$("uploadInputBox"),{sUrl:"/common/upload/SmartEditorUpload",sCallback:"/smartEditor/photo_uploader/popup/callback.html",sFiletype:"*.jpg;*.png;*.bmp;*.gif",sMsgNotAllowedExt:"JPG, GIF, PNG, BMP 확장자만 가능합니다",bAutoUpload:!1,bAutoReset:!0}).attach({select:function(e){e.bAllowed===!0?goStartMode():(goReadyMode(),oFileUploader.reset())},success:function(e){var t=[];t[0]=e.htResult,setPhotoToEditor(t),goReadyMode(),oFileUploader.reset(),window.close()},error:function(e){alert(e.htResult.errstr)}})}function closeWindow(){bSupportDragAndDropAPI&&removeEvent(),window.close()}function setPhotoToEditor(e){opener&&opener.nhn&&opener.nhn.husky&&opener.nhn.husky.PopUpManager&&opener.nhn.husky.PopUpManager.setCallback(window,"SET_PHOTO",[e])}var nImageInfoCnt=0,htImageInfo=[],aResult=[],rFilter=/^(image\/bmp|image\/gif|image\/jpg|image\/jpeg|image\/png)$/i,rFilter2=/^(bmp|gif|jpg|jpeg|png)$/i,nTotalSize=0,nMaxImageSize=10485760,nMaxTotalImageSize=52428800,nMaxImageCount=10,nImageFileCount=0,bSupportDragAndDropAPI=!1,oFileUploader,bAttachEvent=!1,elContent=$("pop_content"),elDropArea=jindo.$$.getSingle(".drag_area",elContent),elDropAreaUL=jindo.$$.getSingle(".lst_type",elContent),elCountTxtTxt=jindo.$$.getSingle("#imageCountTxt",elContent),elTotalSizeTxt=jindo.$$.getSingle("#totalSizeTxt",elContent),elTextGuide=$("guide_text"),welUploadInputBox=$Element("uploadInputBox"),oNavigator=jindo.$Agent().navigator(),welBtnConfirm=$Element("btn_confirm"),welBtnCancel=$Element("btn_cancel"),welTextGuide=$Element(elTextGuide),welDropArea=$Element(elDropArea),welDropAreaUL=$Element(elDropAreaUL),fnUploadImage=null;window.onload=function(){checkDragAndDropAPI(),bSupportDragAndDropAPI?($Element("pop_container2").hide(),$Element("pop_container").show(),welTextGuide.removeClass("nobg"),welTextGuide.className("bg"),addEvent()):($Element("pop_container").hide(),$Element("pop_container2").show(),callFileUploader()),fnUploadImage=$Fn(uploadImage,this),$Fn(closeWindow,this).attach(welBtnCancel.$value(),"click")},jindo.$Ajax.prototype.request=function(e){this._status++;var t,n=this,o=this._request,a=this._options,t="",r=null,i=this._url;if(this._is_abort=!1,t=a.postBody&&"XHR"==a.type.toUpperCase()&&"GET"!=a.method.toUpperCase()?"string"==typeof e?e:jindo.$Json(e).toString():"undefined"!=typeof e&&e?e:null,o.open(a.method.toUpperCase(),i,a.async),a.sendheader){this._headers["Content-Type"]||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),o.setRequestHeader("charset","utf-8");for(var l in this._headers)if(this._headers.hasOwnProperty(l)){if("function"==typeof this._headers[l])continue;o.setRequestHeader(l,String(this._headers[l]))}}var d=navigator.userAgent;if(!o.addEventListener||d.indexOf("Opera")>-1||d.indexOf("MSIE")>-1)if("undefined"!=typeof o.onload)o.onload=function(e){4!=o.readyState||n._is_abort||(clearTimeout(r),r=void 0,n._onload(e))};else if(6==window.navigator.userAgent.match(/(?:MSIE) ([0-9.]+)/)[1]&&a.async){var p=function(e){4!=o.readyState||n._is_abort||(r&&(clearTimeout(r),r=void 0),n._onload(e),clearInterval(n._interval),n._interval=void 0)};this._interval=setInterval(p,300)}else o.onreadystatechange=function(e){4==o.readyState&&(clearTimeout(r),r=void 0,n._onload(e))};else this._loadFunc&&o.removeEventListener("load",this._loadFunc,!1),this._loadFunc=function(e){clearTimeout(r),r=void 0,n._onload(e)},o.addEventListener("load",this._loadFunc,!1);return o.send(t),this};